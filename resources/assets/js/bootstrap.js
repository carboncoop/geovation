$(document).ready(function(){
	highlightHeader();

	$(window).scroll(function(){
		highlightHeader();
	});

	$('[data-modal-trigger]').on('click', function(e){
		e.preventDefault();
		console.log($(this));
		modal.open($(this).data('modal-trigger'));
	});

	$('.modal-save, .modal-close').on('click', function(e){
		e.preventDefault();
		modal.close($(this).closest('.modal'));


		if ($(this).hasClass("modal-save")){
			
			var href = window.location.href;

			$(this).closest('.modal').find("input, select").each(function(index){


				if ($(this).parents().hasClass("chosen-container")){
					// this means the input is a text search field generated by chosen.js, which we're not interested in
				} else if ($(this).hasClass("js-hidden-for-checkbox")){
					// this is a duplicate input, which is hidden. GET requests don't work without it
				} else if ($(this).attr("type") == "checkbox"){
					// we have a checkbox. Need to establish if the "checked" prop is true or not, NOT the value.
					if ($(this).prop("checked") == true){
						var attributeValue = "true";
					} else {
						var attributeValue = "false";
					}
					var attributeName = $(this).attr("id");
					href = updateQueryStringParameter(href, attributeName, attributeValue);
				} else {
					var attributeName = $(this).attr("id");
					var attributeValue = $(this).val();
					href = updateQueryStringParameter(href, attributeName, attributeValue);
				}
			});

			
			window.location.href = href;
		}

	});

	$('.js-return').on('click', function(){
		goBack();
	});


});

	$('.house-illustration a').hover(function(e){
		var infoBox = $(this).data('info-ref');
		$('.'+infoBox).addClass('visible');
		animateDisplayNone($('.'+infoBox),200);
	}, function(){
		var infoBox = $(this).data('info-ref');
		$('.'+infoBox).removeClass('visible');
		animateDisplayNone($('.'+infoBox),200);
	});

function highlightHeader() {
	var $header = $('.site-header'),
		scroll = $(window).scrollTop();

	if (scroll >= 100) {
		$header.addClass('site-header--highlighted');
	} else {
		$header.removeClass('site-header--highlighted');
	}
}

function goBack() {
  window.history.back()
}

var modal = function(){

	var open = function(id) {
		var modalWindow = '[data-modal-id="' + id +'"]';
		$(modalWindow).toggleClass('modal--visible');
		animateDisplayNone($(modalWindow), 150);
	}

	var close = function(modalElem) {
		modalElem.removeClass('modal--visible');
		animateDisplayNone(modalElem, 150);
	}

	return {
		open: open,
		close: close
	}
}();


	function animateDisplayNone(elem, timing) {
		addAnimateClass(elem);
		setTimeout(function(){
			removeAnimateClass(elem);
		},timing);
	}

	function addAnimateClass(elem) {
		elem.addClass('animating');
	}

	function removeAnimateClass(elem) {
		elem.removeClass('animating');
	}